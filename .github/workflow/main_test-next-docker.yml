# Docs for the Azure Web Apps Deploy action: https://github.com/Azure/webapps-deploy
# More GitHub Actions for Azure: https://github.com/Azure/actions

name: Build and Push to azure container Registry

on:
    push:
        branches:
            - main
    workflow_dispatch:

jobs:
    build:
        runs-on: "ubuntu-latest"

        steps:
            - name: checkout repository
            - uses: actions/checkout@main

            - name: Login to Azure Container Registry
              uses: azure/docker-login@v1
              with:
                  login-server: ${{ secrets.ACR_ENDPOINT}}
                  username: ${{ secrets.ACR_USERNAME }}
                  password: ${{ secrets.ACR_PASSWORD }}

            - name: Build & Push
              uses: docker/login-action@v2
              with:
                  push: true
                  build-args: |
                      CONTENTFUL_SPACE_ID=${{ secrets.NEXT_PUBLIC_CONTENTFUL_SPACE_ID }}
                      CONTENTFUL_ACCESS_TOKEN=${{ secrets.NEXT_PUBLIC_CONTENTFUL_ACCESS_TOKEN }}
                  tags: ${{ secrets.ACR_ENDPOINT }}/nextjs-azure:latest
                  file: ./Dockerfile
